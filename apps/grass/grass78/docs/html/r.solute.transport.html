<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>r.solute.transport - GRASS GIS manual</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="grassdocs.css" type="text/css">
</head>
<body bgcolor="white">
<div id="container">

<a href="index.html"><img src="grass_logo.png" alt="GRASS logo"></a>
<hr class="header">

<h2>NAME</h2>
<em><b>r.solute.transport</b></em>  - Numerical calculation program for transient, confined and unconfined solute transport in two dimensions
<h2>KEYWORDS</h2>
<a href="raster.html">raster</a>, <a href="topic_hydrology.html">hydrology</a>, <a href="keywords.html#solute transport">solute transport</a>
<h2>SYNOPSIS</h2>
<div id="name"><b>r.solute.transport</b><br></div>
<b>r.solute.transport --help</b><br>
<div id="synopsis"><b>r.solute.transport</b> [-<b>fc</b>] <b>c</b>=<em>name</em> <b>phead</b>=<em>name</em> <b>hc_x</b>=<em>name</em> <b>hc_y</b>=<em>name</em> <b>status</b>=<em>name</em> <b>diff_x</b>=<em>name</em> <b>diff_y</b>=<em>name</em>  [<b>q</b>=<em>name</em>]   [<b>cin</b>=<em>name</em>]  <b>cs</b>=<em>name</em> <b>rd</b>=<em>name</em> <b>nf</b>=<em>name</em> <b>top</b>=<em>name</em> <b>bottom</b>=<em>name</em> <b>output</b>=<em>name</em>  [<b>vx</b>=<em>name</em>]   [<b>vy</b>=<em>name</em>]  <b>dtime</b>=<em>float</em>  [<b>maxit</b>=<em>integer</em>]   [<b>error</b>=<em>float</em>]   [<b>solver</b>=<em>name</em>]   [<b>relax</b>=<em>float</em>]   [<b>al</b>=<em>float</em>]   [<b>at</b>=<em>float</em>]   [<b>loops</b>=<em>float</em>]   [<b>stab</b>=<em>string</em>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>] 
</div>

<div id="flags">
<h3>Flags:</h3>
<dl>
<dt><b>-f</b></dt>
<dd>Use a full filled quadratic linear equation system, default is a sparse linear equation system.</dd>

<dt><b>-c</b></dt>
<dd>Use the Courant-Friedrichs-Lewy criteria for time step calculation</dd>

<dt><b>--overwrite</b></dt>
<dd>Allow output files to overwrite existing files</dd>
<dt><b>--help</b></dt>
<dd>Print usage summary</dd>
<dt><b>--verbose</b></dt>
<dd>Verbose module output</dd>
<dt><b>--quiet</b></dt>
<dd>Quiet module output</dd>
<dt><b>--ui</b></dt>
<dd>Force launching GUI dialog</dd>
</dl>
</div>

<div id="parameters">
<h3>Parameters:</h3>
<dl>
<dt><b>c</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The initial concentration in [kg/m^3]</dd>

<dt><b>phead</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The piezometric head in [m]</dd>

<dt><b>hc_x</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The x-part of the hydraulic conductivity tensor in [m/s]</dd>

<dt><b>hc_y</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The y-part of the hydraulic conductivity tensor in [m/s]</dd>

<dt><b>status</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The status for each cell, = 0 - inactive cell, 1 - active cell, 2 - dirichlet- and 3 - transfer boundary condition</dd>

<dt><b>diff_x</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The x-part of the diffusion tensor in [m^2/s]</dd>

<dt><b>diff_y</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The y-part of the diffusion tensor in [m^2/s]</dd>

<dt><b>q</b>=<em>name</em></dt>
<dd>Groundwater sources and sinks in [m^3/s]</dd>

<dt><b>cin</b>=<em>name</em></dt>
<dd>Concentration sources and sinks bounded to a water source or sink in [kg/s]</dd>

<dt><b>cs</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>Concentration of inner sources and inner sinks in [kg/s] (i.e. a chemical reaction)</dd>

<dt><b>rd</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>Retardation factor [-]</dd>

<dt><b>nf</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>Effective porosity [-]</dd>

<dt><b>top</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>Top surface of the aquifer in [m]</dd>

<dt><b>bottom</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>Bottom surface of the aquifer in [m]</dd>

<dt><b>output</b>=<em>name</em>&nbsp;<b>[required]</b></dt>
<dd>The resulting concentration of the numerical solute transport calculation will be written to this map. [kg/m^3]</dd>

<dt><b>vx</b>=<em>name</em></dt>
<dd>Calculate and store the groundwater filter velocity vector part in x direction [m/s]<br></dd>

<dt><b>vy</b>=<em>name</em></dt>
<dd>Calculate and store the groundwater filter velocity vector part in y direction [m/s]<br></dd>

<dt><b>dtime</b>=<em>float</em>&nbsp;<b>[required]</b></dt>
<dd>The calculation time in seconds</dd>
<dd>Default: <em>86400</em></dd>

<dt><b>maxit</b>=<em>integer</em></dt>
<dd>Maximum number of iteration used to solve the linear equation system</dd>
<dd>Default: <em>10000</em></dd>

<dt><b>error</b>=<em>float</em></dt>
<dd>Error break criteria for iterative solver</dd>
<dd>Default: <em>0.000001</em></dd>

<dt><b>solver</b>=<em>name</em></dt>
<dd>The type of solver which should solve the linear equation system</dd>
<dd>Options: <em>gauss, lu, jacobi, sor, bicgstab</em></dd>
<dd>Default: <em>bicgstab</em></dd>

<dt><b>relax</b>=<em>float</em></dt>
<dd>The relaxation parameter used by the jacobi and sor solver for speedup or stabilizing</dd>
<dd>Default: <em>1</em></dd>

<dt><b>al</b>=<em>float</em></dt>
<dd>The longditudinal dispersivity length. [m]</dd>
<dd>Default: <em>0.0</em></dd>

<dt><b>at</b>=<em>float</em></dt>
<dd>The transversal dispersivity length. [m]</dd>
<dd>Default: <em>0.0</em></dd>

<dt><b>loops</b>=<em>float</em></dt>
<dd>Use this number of time loops if the CFL flag is off. The timestep will become dt/loops.</dd>
<dd>Default: <em>1</em></dd>

<dt><b>stab</b>=<em>string</em></dt>
<dd>Set the flow stabilizing scheme (full or exponential upwinding).</dd>
<dd>Options: <em>full, exp</em></dd>
<dd>Default: <em>full</em></dd>

</dl>
</div>
<div class="toc">
<h4 class="toc">Table of contents</h4>
<ul class="toc">
    <li class="toc"><a href="#description" class="toc">DESCRIPTION</a></li>
    <li class="toc"><a href="#notes" class="toc">NOTES</a></li>
    <li class="toc"><a href="#example" class="toc">EXAMPLE</a></li>
    <li class="toc"><a href="#see-also" class="toc">SEE ALSO</a></li>
    <li class="toc"><a href="#author" class="toc">AUTHOR</a></li>
</ul>
</div>
<h2><a name="description">DESCRIPTION</a></h2>
This numerical program calculates numerical implicit transient and steady state
solute transport in porous media in the saturated zone of an aquifer. The computation is based on
raster maps and the current region settings. All initial- and boundary-conditions must be provided as
raster maps. The unit in the location must be meters.
<br>
<p>This module is sensitive to mask settings. All cells which are outside the mask
are ignored and handled as no flow boundaries.
<br>
This module calculates the concentration of the solution and optional the
velocity field, based on the hydraulic conductivity, 
the effective porosity and the initial piecometric heads. 
The vector components can be visualized with paraview if they are exported
with r.out.vtk.
<br>
<br>
Use <a href="r.gwflow.html">r.gwflow</a> to compute the piezometric heights
of the aquifer. The piezometric heights and the hydraulic conductivity
are used to compute the flow direction and the mean velocity of the groundwater.
This is the base of the solute transport computation.

<br>
<br>
The solute transport will always be calculated transient. 
For stady state computation set the timestep
to a large number (billions of seconds).
<br>
<br>
To reduce the numerical dispersion, which is a consequence of the convection term and
the finite volume discretization, you can use small time steps and choose between full
and exponential upwinding.

<h2><a name="notes">NOTES</a></h2>
The solute transport calculation is based on a diffusion/convection partial differential equation and
a numerical implicit finite volume discretization. Specific for this kind of differential
equation is the combination of a diffusion/dispersion term and a convection term.
The discretization results in an unsymmetric linear equation system in form of <i>Ax = b</i>,
which must be solved. The solute transport partial
differential equation is of the following form:

<p>(dc/dt)*R = div ( D grad c - uc) + cs -q/nf(c - c_in)

<ul>
<li>c -- the concentration [kg/m^3]</li>
<li>u -- vector of mean groundwater flow velocity</li>
<li>dt -- the time step for transient calculation in seconds [s]</li>
<li>R -- the linear retardation coefficient [-]</li>
<li>D -- the diffusion and dispersion tensor [m^2/s]</li>
<li>cs -- inner concentration sources/sinks [kg/m^3]</li>
<li>c_in -- the solute concentration of influent water [kg/m^3]</li>
<li>q -- inner well sources/sinks [m^3/s]</li>
<li>nf -- the effective porosity [-] </li>
</ul>

<br>
<br>
Three different boundary conditions are implemented,
the Dirichlet, Transmission and Neumann conditions.
The calculation and boundary status of single cells can be set with the status map.
The following states are supportet:

<ul>
<li>0 == inactive - the cell with status 0 will not be calculated, active cells will have a no flow boundary to an inactive cell</li>
<li>1 == active - this cell is used for sloute transport calculation, inner sources can be defined for those cells</li>
<li>2 == Dirichlet - cells of this type will have a fixed concentration value which do not change over time </li>
<li>3 == Transmission - cells of this type should be placed on out-flow boundaries to assure the flow of the solute stream out </li>
</ul>

<br>
<br>
Note that all required raster maps are read into main memory. Additionally the
linear equation system will be allocated, so the memory consumption of this
module rapidely grow with the size of the input maps.

<br>
<br>
The resulting linear equation system <i>Ax = b</i> can be solved with several solvers.
Several iterative solvers with unsymmetric sparse and quadratic matrices support are implemented.
The jacobi method, the Gauss-Seidel method and the biconjugate gradients-stabilized (bicgstab) method. 
Additionally a direct Gauss solver and LU solver are available. Those direct solvers
only work with quadratic matrices, so be careful using them with large maps 
(maps of size 10.000 cells will need more than one gigabyte of ram).
Always prefer a sparse matrix solver.

<h2><a name="example">EXAMPLE</a></h2>
Use this small python script to create a working
groundwater flow / solute transport area and data. 
Make sure you are not in a lat/lon projection.

<div class="code"><pre>
#!/usr/bin/env python3
# This is an example script how groundwater flow and solute transport are
# computed within grass
import sys
import os
import grass.script as grass

# Overwrite existing maps
grass.run_command("g.gisenv", set="OVERWRITE=1")

grass.message(_("Set the region"))

# The area is 200m x 100m with a cell size of 1m x 1m
grass.run_command("g.region", res=1, res3=1, t=10, b=0, n=100, s=0, w=0, e=200)
grass.run_command("r.mapcalc", expression="phead = if(col() == 1 , 50, 40)")
grass.run_command("r.mapcalc", expression="phead = if(col() ==200  , 45 + row()/40, phead)")
grass.run_command("r.mapcalc", expression="status = if(col() == 1 || col() == 200 , 2, 1)")
grass.run_command("r.mapcalc", expression="well = if((row() == 50 && col() == 175) || (row() == 10 && col() == 135) , -0.001, 0)")
grass.run_command("r.mapcalc", expression="hydcond = 0.00005")
grass.run_command("r.mapcalc", expression="recharge = 0")
grass.run_command("r.mapcalc", expression="top_conf = 20")
grass.run_command("r.mapcalc", expression="bottom = 0")
grass.run_command("r.mapcalc", expression="poros = 0.17")
grass.run_command("r.mapcalc", expression="syield = 0.0001")
grass.run_command("r.mapcalc", expression="null = 0.0")

grass.message(_("Compute a steady state groundwater flow"))

grass.run_command("r.gwflow", solver="cg", top="top_conf", bottom="bottom", phead="phead",\
  status="status", hc_x="hydcond", hc_y="hydcond", q="well", s="syield",\
  recharge="recharge", output="gwresult_conf", dt=8640000000000, type="confined")

grass.message(_("generate the transport data"))
grass.run_command("r.mapcalc", expression="c = if(col() == 15 &amp;&amp; row() == 75 , 500.0, 0.0)")
grass.run_command("r.mapcalc", expression="cs = if(col() == 15 &amp;&amp; row() == 75 , 0.0, 0.0)")
grass.run_command("r.mapcalc", expression="tstatus = if(col() == 1 || col() == 200 , 3, 1)")
grass.run_command("r.mapcalc", expression="diff = 0.0000001")
grass.run_command("r.mapcalc", expression="R = 1.0")

# Compute the initial state
grass.run_command("r.solute.transport", solver="bicgstab", top="top_conf",\
  bottom="bottom", phead="gwresult_conf", status="tstatus", hc_x="hydcond", hc_y="hydcond",\
  rd="R", cs="cs", q="well", nf="poros", output="stresult_conf_0", dt=3600, diff_x="diff",\
  diff_y="diff", c="c", al=0.1, at=0.01)

# Compute the solute transport for 300 days in 10 day steps
for dt in range(30):
    grass.run_command("r.solute.transport", solver="bicgstab", top="top_conf",\
    bottom="bottom", phead="gwresult_conf", status="tstatus", hc_x="hydcond", hc_y="hydcond",\
    rd="R", cs="cs", q="well", nf="poros", output="stresult_conf_" + str(dt + 1), dt=864000, diff_x="diff",\
    diff_y="diff", c="stresult_conf_" + str(dt), al=0.1, at=0.01)
</pre></div>

<h2><a name="see-also">SEE ALSO</a></h2>

<em><a href="r.gwflow.html">r.gwflow</a></em><br>
<em><a href="r3.gwflow.html">r3.gwflow</a></em><br>
<em><a href="r.out.vtk.html">r.out.vtk</a></em><br>

<h2><a name="author">AUTHOR</a></h2>
S&ouml;ren Gebbert
<p>This work is based on the Diploma Thesis of S&ouml;ren Gebbert available
<a href="https://grass.osgeo.org/gdp/hydrology/gebbert2007_diplom_stroemung_grass_gis.pdf">here</a>
at Technical University Berlin in Germany.


<!--
<p>
<i>Last changed: $Date$</i>
--><h2>SOURCE CODE</h2>
<p>Available at: <a href="https://github.com/OSGeo/grass/tree/master/raster/r.solute.transport">r.solute.transport source code</a> (<a href="https://github.com/OSGeo/grass/commits/master/raster/r.solute.transport">history</a>)</p>
<hr class="header">
<p>
<a href="index.html">Main index</a> |
<a href="raster.html">Raster index</a> |
<a href="topics.html">Topics index</a> |
<a href="keywords.html">Keywords index</a> |
<a href="graphical_index.html">Graphical index</a> |
<a href="full_index.html">Full index</a>
</p>
<p>
&copy; 2003-2020
<a href="http://grass.osgeo.org">GRASS Development Team</a>,
GRASS GIS 7.8.5 Reference Manual
</p>

</div>
</body>
</html>
